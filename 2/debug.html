<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript Konsol Testi</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }

        .console {
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            max-height: 500px;
            overflow-y: auto;
        }

        .error {
            color: #f48771;
        }

        .success {
            color: #4ec9b0;
        }

        .warning {
            color: #dcdcaa;
        }

        .info {
            color: #9cdcfe;
        }

        button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 3px;
            cursor: pointer;
        }

        button:hover {
            background: #1177bb;
        }

        pre {
            margin: 5px 0;
            white-space: pre-wrap;
        }
    </style>
</head>

<body>
    <h1>üîç JavaScript Hata Tespit Sistemi</h1>

    <button onclick="testAppJS()">app.js'i Test Et</button>
    <button onclick="clearConsole()">Konsolu Temizle</button>
    <button onclick="location.href='index.html'">Ana Uygulamayƒ± A√ß</button>

    <div id="console" class="console">
        <pre class="info">Konsol hazƒ±r. "app.js'i Test Et" butonuna tƒ±klayƒ±n...</pre>
    </div>

    <script>
        const consoleDiv = document.getElementById('console');

        function log(message, type = 'info') {
            const pre = document.createElement('pre');
            pre.className = type;
            pre.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            consoleDiv.appendChild(pre);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        function clearConsole() {
            consoleDiv.innerHTML = '<pre class="info">Konsol temizlendi.</pre>';
        }

        // Ger√ßek console'u yakala
        const originalError = console.error;
        const originalLog = console.log;

        console.error = function (...args) {
            log('ERROR: ' + args.join(' '), 'error');
            originalError.apply(console, args);
        };

        console.log = function (...args) {
            log('LOG: ' + args.join(' '), 'info');
            originalLog.apply(console, args);
        };

        window.addEventListener('error', function (e) {
            log(`GLOBAL ERROR: ${e.message} (${e.filename}:${e.lineno})`, 'error');
        });

        async function testAppJS() {
            clearConsole();
            log('Test ba≈ülƒ±yor...', 'info');

            try {
                // 1. Dosya var mƒ±?
                log('1. app.js dosyasƒ± kontrol ediliyor...', 'info');
                const response = await fetch('app.js');
                if (!response.ok) {
                    log(`HATA: app.js y√ºklenemedi (${response.status})`, 'error');
                    return;
                }

                const code = await response.text();
                log(`‚úì app.js y√ºklendi (${(code.length / 1024).toFixed(2)} KB)`, 'success');

                // 2. Syntax kontrol√º
                log('2. Syntax kontrol ediliyor...', 'info');
                try {
                    new Function(code);
                    log('‚úì Syntax hatasƒ± YOK', 'success');
                } catch (syntaxError) {
                    log(`SYNTAX HATASI: ${syntaxError.message}`, 'error');
                    return;
                }

                // 3. Kritik kod par√ßalarƒ± var mƒ±?
                log('3. Kritik fonksiyonlar kontrol ediliyor...', 'info');
                const checks = [
                    { name: 'DOMContentLoaded', pattern: /DOMContentLoaded/ },
                    { name: 'renderApp', pattern: /function renderApp/ },
                    { name: 'loadData', pattern: /function loadData/ },
                    { name: 'saveData', pattern: /function saveData/ },
                    { name: 'switchTab', pattern: /window\.switchTab/ }
                ];

                checks.forEach(check => {
                    if (check.pattern.test(code)) {
                        log(`  ‚úì ${check.name} bulundu`, 'success');
                    } else {
                        log(`  ‚úó ${check.name} BULUNAMADI!`, 'error');
                    }
                });

                // 4. ≈ûimdi ger√ßekten y√ºkle
                log('4. app.js y√ºkleniyor...', 'info');
                const script = document.createElement('script');
                script.src = 'app.js';
                script.onload = () => {
                    log('‚úì app.js ba≈üarƒ±yla y√ºklendi!', 'success');

                    // 5. Window objelerini kontrol et
                    setTimeout(() => {
                        log('5. Global deƒüi≈ükenler kontrol ediliyor...', 'info');
                        if (window.appData) {
                            log('  ‚úì window.appData var', 'success');
                        } else {
                            log('  ‚úó window.appData YOK', 'error');
                        }

                        if (window.switchTab) {
                            log('  ‚úì window.switchTab var', 'success');
                        } else {
                            log('  ‚úó window.switchTab YOK', 'error');
                        }

                        log('TEST TAMAMLANDI!', 'success');
                        log('Eƒüer hatalar varsa yukarƒ±daki kƒ±rmƒ±zƒ± satƒ±rlara bakƒ±n.', 'warning');
                    }, 1000);
                };
                script.onerror = () => {
                    log('HATA: app.js y√ºklenirken hata olu≈ütu!', 'error');
                };
                document.head.appendChild(script);

            } catch (error) {
                log(`TEST HATASI: ${error.message}`, 'error');
            }
        }
    </script>
</body>

</html>